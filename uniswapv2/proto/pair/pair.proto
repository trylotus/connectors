syntax = "proto3";

package pair;

import "google/protobuf/timestamp.proto";
import "lotus/lotus.proto";

option go_package = "github.com/trylotus/connectors/uniswapv2/pair";

message Approval {
  option (lotus.composite).index = {
    unique: true
    fields: [
      "ts",
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "pair",
      "ts"
    ]
  };

  google.protobuf.Timestamp ts = 1;
  uint64 block_number = 2 [(lotus.index) = {}];
  bytes tx_hash = 3 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  uint64 log_index = 4;
  bytes pair = 5 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  bytes owner = 6 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  bytes spender = 7 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  string value = 8 [(lotus.numeric) = {}];
}

message Burn {
  option (lotus.composite).index = {
    unique: true
    fields: [
      "ts",
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "pair",
      "ts"
    ]
  };

  google.protobuf.Timestamp ts = 1;
  uint64 block_number = 2 [(lotus.index) = {}];
  bytes tx_hash = 3 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  uint64 log_index = 4;
  bytes pair = 5 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  bytes sender = 6 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  string amount0 = 7 [(lotus.numeric) = {}];
  string amount1 = 8 [(lotus.numeric) = {}];
  bytes to = 9 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
}

message Mint {
  option (lotus.composite).index = {
    unique: true
    fields: [
      "ts",
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "pair",
      "ts"
    ]
  };

  google.protobuf.Timestamp ts = 1;
  uint64 block_number = 2 [(lotus.index) = {}];
  bytes tx_hash = 3 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  uint64 log_index = 4;
  bytes pair = 5 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  bytes sender = 6 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  string amount0 = 7 [(lotus.numeric) = {}];
  string amount1 = 8 [(lotus.numeric) = {}];
}

message Swap {
  option (lotus.composite).index = {
    unique: true
    fields: [
      "ts",
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "pair",
      "ts"
    ]
  };

  google.protobuf.Timestamp ts = 1;
  uint64 block_number = 2 [(lotus.index) = {}];
  bytes tx_hash = 3 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  uint64 log_index = 4;
  bytes pair = 5 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  bytes sender = 6 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  string amount0_in = 7 [(lotus.numeric) = {}];
  string amount1_in = 8 [(lotus.numeric) = {}];
  string amount0_out = 9 [(lotus.numeric) = {}];
  string amount1_out = 10 [(lotus.numeric) = {}];
  bytes to = 11 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
}

message Sync {
  option (lotus.composite).index = {
    unique: true
    fields: [
      "ts",
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "pair",
      "ts"
    ]
  };

  google.protobuf.Timestamp ts = 1;
  uint64 block_number = 2 [(lotus.index) = {}];
  bytes tx_hash = 3 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  uint64 log_index = 4;
  bytes pair = 5 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  string reserve0 = 6 [(lotus.numeric) = {}];
  string reserve1 = 7 [(lotus.numeric) = {}];
}

message Transfer {
  option (lotus.composite).index = {
    unique: true
    fields: [
      "ts",
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "tx_hash",
      "log_index"
    ]
  };
  option (lotus.composite).index = {
    fields: [
      "pair",
      "ts"
    ]
  };

  google.protobuf.Timestamp ts = 1;
  uint64 block_number = 2 [(lotus.index) = {}];
  bytes tx_hash = 3 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  uint64 log_index = 4;
  bytes pair = 5 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  bytes from = 6 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  bytes to = 7 [(lotus.bytes) = {format: FORMAT_TYPE_HEX}];
  string value = 8 [(lotus.numeric) = {}];
}

message Price1min {
  option (lotus.view) = {
    topic: "lotus.uniswapv2.0_0_0.pair_Sync"
    materialized: true
    realtime: true
    refresh_interval: '1 min'
    options: ["timescaledb.continuous"]
    group_by: [
      "t",
      "pair"
    ]
    where: "reserve0 > 0"
  };

  option (lotus.composite).index = {
    fields: [
      "pair",
      "t"
    ]
  };

  google.protobuf.Timestamp t = 1 [(lotus.projection) = "time_bucket('1 min', ts)"];
  bytes pair = 2 [
    (lotus.projection) = "pair",
    (lotus.bytes) = {format: FORMAT_TYPE_HEX}
  ];
  string open_price = 3 [
    (lotus.projection) = "first(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string max_price = 4 [
    (lotus.projection) = "max(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string min_price = 5 [
    (lotus.projection) = "min(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string close_price = 6 [
    (lotus.projection) = "last(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string avg_price = 7 [
    (lotus.projection) = "avg(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
}

message Price10min {
  option (lotus.view) = {
    topic: "lotus.uniswapv2.0_0_0.pair_Sync"
    materialized: true
    realtime: true
    refresh_interval: '10 min'
    options: ["timescaledb.continuous"]
    group_by: [
      "t",
      "pair"
    ]
    where: "reserve0 > 0"
  };

  option (lotus.composite).index = {
    fields: [
      "pair",
      "t"
    ]
  };

  google.protobuf.Timestamp t = 1 [(lotus.projection) = "time_bucket('10 min', ts)"];
  bytes pair = 2 [
    (lotus.projection) = "pair",
    (lotus.bytes) = {format: FORMAT_TYPE_HEX}
  ];
  string open_price = 3 [
    (lotus.projection) = "first(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string max_price = 4 [
    (lotus.projection) = "max(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string min_price = 5 [
    (lotus.projection) = "min(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string close_price = 6 [
    (lotus.projection) = "last(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string avg_price = 7 [
    (lotus.projection) = "avg(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
}

message Price1h {
  option (lotus.view) = {
    topic: "lotus.uniswapv2.0_0_0.pair_Sync"
    materialized: true
    realtime: true
    refresh_interval: '10 min'
    options: ["timescaledb.continuous"]
    group_by: [
      "t",
      "pair"
    ]
    where: "reserve0 > 0"
  };

  option (lotus.composite).index = {
    fields: [
      "pair",
      "t"
    ]
  };

  google.protobuf.Timestamp t = 1 [(lotus.projection) = "time_bucket('1 hour', ts)"];
  bytes pair = 2 [
    (lotus.projection) = "pair",
    (lotus.bytes) = {format: FORMAT_TYPE_HEX}
  ];
  string open_price = 3 [
    (lotus.projection) = "first(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string max_price = 4 [
    (lotus.projection) = "max(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string min_price = 5 [
    (lotus.projection) = "min(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string close_price = 6 [
    (lotus.projection) = "last(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string avg_price = 7 [
    (lotus.projection) = "avg(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
}

message Price1d {
  option (lotus.view) = {
    topic: "lotus.uniswapv2.0_0_0.pair_Sync"
    materialized: true
    realtime: true
    refresh_interval: '1 hour'
    options: ["timescaledb.continuous"]
    group_by: [
      "t",
      "pair"
    ]
    where: "reserve0 > 0"
  };

  option (lotus.composite).index = {
    fields: [
      "pair",
      "t"
    ]
  };

  google.protobuf.Timestamp t = 1 [(lotus.projection) = "time_bucket('1 day', ts)"];
  bytes pair = 2 [
    (lotus.projection) = "pair",
    (lotus.bytes) = {format: FORMAT_TYPE_HEX}
  ];
  string open_price = 3 [
    (lotus.projection) = "first(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string max_price = 4 [
    (lotus.projection) = "max(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string min_price = 5 [
    (lotus.projection) = "min(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string close_price = 6 [
    (lotus.projection) = "last(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string avg_price = 7 [
    (lotus.projection) = "avg(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
}

message Price1mon {
  option (lotus.view) = {
    topic: "lotus.uniswapv2.0_0_0.pair_Sync"
    materialized: true
    realtime: true
    refresh_interval: '1 hour'
    options: ["timescaledb.continuous"]
    group_by: [
      "t",
      "pair"
    ]
    where: "reserve0 > 0"
  };

  option (lotus.composite).index = {
    fields: [
      "pair",
      "t"
    ]
  };

  google.protobuf.Timestamp t = 1 [(lotus.projection) = "time_bucket('1 month', ts)"];
  bytes pair = 2 [
    (lotus.projection) = "pair",
    (lotus.bytes) = {format: FORMAT_TYPE_HEX}
  ];
  string open_price = 3 [
    (lotus.projection) = "first(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string max_price = 4 [
    (lotus.projection) = "max(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string min_price = 5 [
    (lotus.projection) = "min(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string close_price = 6 [
    (lotus.projection) = "last(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string avg_price = 7 [
    (lotus.projection) = "avg(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
}

message Price1y {
  option (lotus.view) = {
    topic: "lotus.uniswapv2.0_0_0.pair_Sync"
    materialized: true
    realtime: true
    refresh_interval: '1 hour'
    options: ["timescaledb.continuous"]
    group_by: [
      "t",
      "pair"
    ]
    where: "reserve0 > 0"
  };

  option (lotus.composite).index = {
    fields: [
      "pair",
      "t"
    ]
  };

  google.protobuf.Timestamp t = 1 [(lotus.projection) = "time_bucket('1 year', ts)"];
  bytes pair = 2 [
    (lotus.projection) = "pair",
    (lotus.bytes) = {format: FORMAT_TYPE_HEX}
  ];
  string open_price = 3 [
    (lotus.projection) = "first(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string max_price = 4 [
    (lotus.projection) = "max(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string min_price = 5 [
    (lotus.projection) = "min(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
  string close_price = 6 [
    (lotus.projection) = "last(reserve1 / reserve0, ts)",
    (lotus.numeric) = {}
  ];
  string avg_price = 7 [
    (lotus.projection) = "avg(reserve1 / reserve0)",
    (lotus.numeric) = {}
  ];
}
